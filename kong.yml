_format_version: "2.1"

services:
  - host: pagos_health_upstream
    name: pagos_health_service
    protocol: http
    routes:
      - name: pagos
        paths:
          - /pagos/
        strip_path: false
    plugins:
      - name: request-termination
        config:
          status_code: 302
          content_type: "application/json"
          body: '{"message": "Servicio Ca√≠do notificando a los chambeadores..."}'
        enabled: true
      - name: http-log
        config:
          http_endpoint: "http://10.128.0.52:8080/pagos/avisar/"  
          method: GET
          timeout: 1000
          keepalive: 1000
    
upstreams:
  - name: pagos_health_upstream
    targets:
      - target: 10.128.0.52:8080
        weight: 100
      - target: 10.128.0.53:8080
        weight: 100
      - target: 10.128.0.54:8080
        weight: 100
    healthchecks:
      threshold: 50
      active:
        http_path: /health-check/
        timeout: 5
        healthy:
          successes: 2
          interval: 5
        unhealthy:
          tcp_failures: 2
          interval: 5

